<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Staging Template">
    <meta name="keywords" content="Staging, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>회원가입</title>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbit&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
<!-- Page Preloder -->
<div id="preloder">
    <div class="loader"></div>
</div>

<!-- Offcanvas Menu Begin -->
<div class="offcanvas-menu-overlay"></div>
<div class="offcanvas-menu-wrapper">
    <div class="offcanvas__logo">
        <a href="#" style="font-size: 40px; color: white">MyCloset</a>
    </div>
    <div id="mobile-menu-wrap"></div>
</div>
<!-- Offcanvas Menu End -->

<!-- Header Section Begin -->
<header class="header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3">
                <div class="header__logo">
                    <a href="#" style="font-size: 40px; color: white">MyCloset</a>
                </div>
            </div>
            <div class="col-lg-6">
                <nav class="header__menu mobile-menu">
                    <ul>
                        <li class="active"><a href="/index.html">Home</a></li>
                        <li><a href="/security/login.html">MyPage</a></li>
                        <li><a href="/security/login.html">Closet</a></li>
                        <li><a href="/security/login.html">Chatbot</a></li>
                        <li><a href="/security/login.html">Community</a></li>
                        <li><a href="/security/login.html">Style Dictionary</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="canvas__open"><i class="fa fa-bars"></i></div>
    </div>
</header>
<!-- Header Section End -->

<!-- Contact Section Begin -->
<form id="f">
    <section class="contact spad" style="background-color: #5a6268; margin-bottom: -75px">
        <div class="container">
            <div class="card border-secondary mb-3" style="height: 750px">
                <div class="card-header">회원가입</div>
                <div class="card-body">
                    <div>
                        <label for="nickname" class="form-label mt-4">nickname</label>
                        <div style="display: flex; justify-content: space-between">
                            <input type="text" class="form-control" name="nickName" id="nickName" placeholder="nickname"
                                   style="width: 75%">
                            <button id="checkNickName" class="btn btn-outline-dark" type="button" style="width: 20%">
                                확인
                            </button>
                        </div>
                    </div>
                    <div>
                        <label for="email" class="form-label mt-4">email</label>
                        <div style="display: flex; justify-content: space-between">
                            <input type="text" class="form-control" id="email" name="email" placeholder="name"
                                   style="width: 75%">
                            <button id="checkEmail" class="btn btn-outline-dark" type="button" style="width: 20%">확인
                            </button>
                        </div>
                    </div>
                    <div>
                        <label for="userId" class="form-label mt-4">ID</label>
                        <div style="display: flex; justify-content: space-between">
                            <input type="text" class="form-control" id="userId" name="userId" placeholder="ID"
                                   style="width: 75%">
                            <button id="checkUserId" class="btn btn-outline-dark" type="button" style="width: 20%">확인
                            </button>
                        </div>
                    </div>
                    <div>
                        <label for="password" class="form-label mt-4">Password</label>
                        <input type="password" class="form-control" id="password" name="password" placeholder="Password"
                               autocomplete="off">
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <div style="width: 50%; vertical-align: center">
                            <label class="form-label mt-4">성별</label>
                            <div style="justify-content: space-between">
                                <div class="form-check" style="margin-right: 10px">
                                    <input class="form-check-input" type="radio" name="gender" id="option1"
                                           value="남" checked="">
                                    <label class="form-check-label" for="option1">
                                        남
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="options2"
                                           value="여">
                                    <label class="form-check-label" for="options2">
                                        여
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div style="width: 50%">
                            <label for="age" class="form-label mt-4">나이</label>
                            <input type="text" class="form-control" id="age" name="age" placeholder="age"
                                   style="width: 90%">
                        </div>
                        <div style="display: none">
                            <label for="age" class="form-label mt-4">isKakao</label>
                            <input type="text" class="form-control" id="isKakao" value="normal" name="isKakao"
                                   placeholder="age" style="width: 90%">
                        </div>
                    </div>
                    <hr>
                    <button type="submit" id="insertUser" class="btn btn-dark" style="width: 100%">회원가입</button>
                </div>
            </div>
        </div>
    </section>
</form>
<!-- Contact Section End -->

<!-- Footer Section Begin -->
<footer class="footer set-bg" data-setbg="/img/footer-bg.jpg">
    <div class="container">
        <div class="copyright" style="margin-top: -90px">
            <div class="row">
                <div class="col-lg-8 col-md-7">
                    <div class="copyright__text">
                        <p>Copyright ©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>
                            All rights reserved | This template is made with <i class="fa fa-heart-o"
                                                                                aria-hidden="true"></i> by <a
                                    href="https://colorlib.com"
                                    target="_blank">Colorlib</a>
                        </p>
                    </div>
                </div>
                <div class="col-lg-4 col-md-5">
                    <div class="copyright__widget">
                        <a href="#">Terms of use</a>
                        <a href="#">Privacy Policy</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- Footer Section End -->

<!-- Js Plugins -->
<script src="/js/jquery-3.6.0.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.slicknav.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/slick.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/common.js"></script>
<script src="/js/jquery.cookie.js"></script>
<script src="/js/jquery.serializeObject.min.js"></script>
<script type="text/javascript">

    // 유효성 검사 함수
    // 아이디 글자수 제한 4 ~ 12자
    function idLength(value) {
        return value.length >= 4 && value.length <= 12
    }

    // 아이디 영어 또는 숫자만 가능
    function onlyNumberAndEnglish(str) {
        return /^[A-Za-z0-9][A-Za-z0-9]*$/.test(str);
    }

    // 숫자만 가능
    function onlyNumber(value) {
        return /^[0-9]{1,2}$/.test(value);
    }


    // 비밀번호 8글자 이상, 영문, 숫자, 특수문자 사용
    function strongPassword (str) {
        return /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/.test(str);
    }

    $(document).ready(function () {

        let f = document.getElementById("f");
        f.addEventListener('submit', ev => {
            console.log(ev);
            ev.stopPropagation();
            ev.preventDefault();
        })

        let emailResult;
        let nickNameResult;
        let userIdResult;

        $("#checkEmail").on("click", function () {

            let emailFormat = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/;

                if (f.email.value === "") {
                    alert("이메일을 입력하세요.");
                    f.email.focus();
                    return;
                }

                if (!emailFormat.test(f.email.value)) {
                    alert("올바른 이메일 형식으로 입력하세요.");
                    f.email.focus();
                    return;
                }

                $.ajax({
                    url: "http://" + apiServer + "/security/v1/checkEmail",
                    type: "post",
                    dataType: "JSON",
                    xhrFields: {
                        withCredentials: true
                    },
                    data: {email: f.email.value}
                }).then(
                    function (json) {
                        if (json.data.result == 1) {
                            alert(json.data.msg);
                            emailResult = 1;
                            console.log(emailResult);
                            $("#userId").focus();
                        } else {
                            alert(json.data.msg);
                            console.log(emailResult);
                            $("#email").focus();
                        }
                    }
                )
            }
        )

        $("#checkNickName").on("click", function () {
            if (f.nickName.value === "") {
                alert("닉네임을 입력하세요.");
                f.nickName.focus();
                return;
            }

            $.ajax({
                url: "http://" + apiServer + "/security/v1/checkNickName",
                type: "post",
                dataType: "JSON",
                xhrFields: {
                    withCredentials: true
                },
                data: {nickName: f.nickName.value}
            }).then(
                function (json) {
                    if (json.data.result == 1) {
                        alert(json.data.msg);
                        nickNameResult = 1;
                        console.log(nickNameResult);
                        $("#email").focus();
                    } else {
                        alert(json.data.msg);
                        console.log(nickNameResult);
                        $("#nickname").focus();
                    }
                }
            )
        })

        $("#checkUserId").on("click", function () {
            if (f.userId.value === "") {
                alert("아이디를 입력하세요.");
                f.userId.focus();
                return;
            }

            if (idLength(f.userId.value) === false) {
                alert("아이디는 4글자 이상 12글자 이하만 입력 가능합니다.");
                f.userId.focus();
                return;
            }

            if (onlyNumberAndEnglish(f.userId.value) === false) {
                alert("아이디는 영어, 숫자만 입력 가능합니다.");
                f.userId.focus();
                return;
            }

            $.ajax({
                url: "http://" + apiServer + "/security/v1/checkId",
                type: "post",
                dataType: "JSON",
                xhrFields: {
                    withCredentials: true
                },
                data: {userId: f.userId.value}
            }).then(
                function (json) {
                    if (json.data.result == 1) {
                        alert(json.data.msg);
                        userIdResult = 1;
                        console.log(userIdResult);
                        $("#").focus();
                    } else {
                        alert(json.data.msg);
                        console.log(userIdResult);
                        $("#email").focus();
                    }
                }
            )
        })


        $("#insertUser").on("click", function () {

            if (f.nickName.value === "") {
                alert("닉네임을 입력하세요.");
                f.nickName.focus();
                return;
            }
            if (f.email.value === "") {
                alert("이메일을 입력하세요.");
                f.email.focus();
                return;
            }
            if (f.userId.value === "") {
                alert("아이디를 입력하세요.");
                f.userId.focus();
                return;
            }
            if (f.password.value === "") {
                alert("비밀번호를 입력하세요.");
                f.password.focus();
                return;
            }
            if (strongPassword(f.password.value) === false) {
                alert("비밀번호는 최소 8글자 이상, 알파벳과 숫자와 특수문자를 포함해야합니다.")
                f.password.focus();
                return;
            }
            if (f.age.value === "") {
                alert("나이를 입력하세요.");
                f.age.focus();
                return;
            }
            if (onlyNumber(f.age.value) === false) {
                alert("숫자만 입력 가능합니다.")
                return;
            }
            if (userIdResult === undefined) {
                alert("ID 중복체크를 하시길 바랍니다.");
                return
            }
            if (emailResult === undefined) {
                alert("Email 중복체크를 하시길 바랍니다.");
                return
            }
            if (nickNameResult === undefined) {
                alert("닉네임 중복체크를 하시길 바랍니다.")
                return
            }

            console.log(userIdResult)
            console.log(emailResult)
            console.log(nickNameResult)
            if (userIdResult === 1 && emailResult === 1 && nickNameResult === 1) {
                $.ajax({
                    url: "http://" + apiServer + "/security/v1/signUp",
                    type: "post",
                    dataType: "JSON",
                    xhrFields: {
                        withCredentials: true
                    },
                    data: $("#f").serializeObject()
                }).then(
                    function (json) {
                        if (json.data.result === 1) {
                            alert(json.data.msg);
                            console.log("이거실행")
                            location.href = "/security/login.html"
                        } else if (json.data.result === 2) {
                            alert(json.data.msg);
                            console.log("이거실행")
                            $("#userId").focus();
                        } else {
                            alert(json.data.msg);
                            console.log("이거실행")
                            $("#userId").focus();
                        }
                    }
                )
            } else {
                alert("회원가입에 실패하였습니다. 다시 시도해주시길 바랍니다.")
            }
        })
    })

</script>
</body>
</html>